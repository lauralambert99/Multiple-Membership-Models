[["index.html", "Multiple Membership Models: A tutorial Chapter 1 About 1.1 R packages used 1.2 Acknowledgements 1.3 A Disclaimer 1.4 Preview book", " Multiple Membership Models: A tutorial Laura Lambert 2023-05-01 Chapter 1 About This is a sample book written in Markdown. You can use anything that Pandocs Markdown supports; for example, a math equation \\(a^2 + b^2 = c^2\\). 1.1 R packages used Calculations and data manipulations performed in this tutorial made use of the following R packages: Bookdown ((bookdown?)) knitr ((knitr?)) Rmarkdown ((rmarkdown?)) Tidyverse ((tidyverse?)) ggplot2 ((ggplot2?)) R2MLwiN ((R2MLwiN?)) 1.2 Acknowledgements Much of the background information about multiple membership models was gathered from the learning resources provided by the University of Bristols Center for Multilevel Modelling ( (n.d.a)). 1.3 A Disclaimer The data used in this tutorial were simulated by me, and I am certain that a better job could have been done to better reflect some dependencies that should be in the data. One known omission is variance components were not specified prior to estimating the outcome. However, these data were simulated to reflect a student population at JMU to the best of my ability at the time and no intentional errors or misrepresentations were intended. Data-generating code is included in the Appendix. You can render the HTML version of this example book without changing anything: Find the Build pane in the RStudio IDE, and Click on Build Book, then select your output format, or select All formats if youd like to use multiple formats from the same book source files. Or build the book from the R console: bookdown::render_book() To render this example to PDF as a bookdown::pdf_book, youll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): https://yihui.org/tinytex/. 1.4 Preview book As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in Preview book, or from the R console: bookdown::serve_book() References "],["introduction.html", "Chapter 2 Introduction 2.1 Non-hierarchical models in brief", " Chapter 2 Introduction When evaluating data in the educational field and in many other fields, researchers often run into the problem of their data being nested or clustered. When this occurs, they are no longer able to use multiple regression, as they would be violating the independent observations assumption, and may instead turn to multilevel modeling. With multilevel modeling, a researcher is able to handle students nested in schools and patients nested in nurses, as well as longitudinal models where time points are nested within individuals. However, a key facet to all of these models is the strict hierarchical nature of the data: each level one unit (students, patients, or time points) is nested within one, and only one, level 2 unit (school, nurse, individual). If we were to draw this relationship, it would look like Figure 1: there are no lines that are crossed, and each level one unit is associated with only one level two unit. This can also be represented in table form; a true hierarchical model will only have one row (cite rr thingmaybe LEMMA thing?). (#tab:true hierarchical table)Data distribution indicating a true hierarchical model student Math_Teacher_1 Math_Teacher_2 Math_Teacher_3 student 1, 2 3, 4 5, 6 Two level strict hierarchical models can be written as two separate equations, each representing a level of the model. \\[y_{ij} = \\beta_{0j} + r_{ij}\\] \\[\\beta_{0j} = \\gamma_{00} + u_{0j}\\], With these equations, \\(y_{ij}\\) is outcome and \\(\\beta_{0j}\\) represents intercepts. In the intercept-only model presented, there are no slope components, but if we were to add in predictors, we could examine how slopes vary. \\(r_{ij}\\) is the random variation in level one, while \\(u_{0j}\\) is random variation in level 2 (Raudenbush &amp; Bryk, 2002; Snijders &amp; Bosker, 2012). 2.1 Non-hierarchical models in brief While data can be purely hierarchical as described above, situations often arise when level 1 units do not fit neatly into one and only one level 2 cluster. One example of this type of non-hierarchical model is a cross-classified model. In this instance, level 1 units are members of more than one level two cluster, but there is not a pure hierarchy. For example, students may be nested within both biology classes and chemistry classes, with the outcome measurement being science knowledge. It would seem wise to take into account both the impact of biology classes as well as chemistry classes. However, students who were in the same biology class are not all in the same chemistry class. This situation would require the use of a cross-classified model. Cross-classified models, like pure hierarchical models, can also be represented in table or visual form. In table form, the cross classified structure becomes evident when there are level one units in more than one row and column. In the simple example below, there are multiple cells filled in both rows (Physics Teacher 1 and 2) and in columns (Math Teacher 2). (#tab:cross classified table)Data distribution indicating a cross-classified model X. Physics.Teacher.1 Physics.Teacher.2 Math Teacher 1 1, 2 Math Teacher 2 3 4 Math Teacher 3 5, 6 Another type of non-hierarchical model is a multiple membership model. In this instance, there is only one level 2 cluster being considered, but the level 1 units do not all belong to one and only one cluster. These types of models are frequently employed in education to model what are termed mobile students: students who attend more than one school over a school year, or more than one elementary school prior to a state-wide 5th grade test. Multiple membership data are less evident in table form unless you are paying careful attention to the population in each cell, but becomes more evident in a unit diagram. As with the other diagrams, however, these can quickly become visually confusing with large data sets. Moving forward, we will focus exclusively on multiple membership models. "],["data.html", "Chapter 3 Data 3.1 Compact vs. long forms 3.2 Examining the Data 3.3 Software Considerations 3.4 Captioned figures and tables", " Chapter 3 Data The data used for this tutorial were simulated in R to loosely represent a cohort of JMU students. As accurate counts and frequencies of the predictors were not available outside of a request to PAIR, best guesses were employed where necessary. In a fictional scenario, JMU has decided to add a Math Achievement Test as a graduation requirement: students must take this test the semester they anticipate graduating as a measure of their Math Achievement at JMU, with the point of comparison being a cut-score. The stakes are similar to Assessment Day and there are no penalties for low scores. JMU, recognizing that many factors may play into how well a student does on this test, wants to consider the role different math teachers play as well as some student-level predictors. Not wanting this to hold any penalty towards teachers either, JMU has assigned each teacher an anonymous ID and associated it with the years of experience. JMU is additionally considering what teacher qualities help students be more successful, with the idea of offering more professional development in those areas. Currently, the only teacher-level predictor available is number of years of experience of the instructor. JMU hopes to answer the following research questions: The predictors are listed in the table below, along with a brief description. knitr::kable(df, booktabs = TRUE, caption = &#39;Simulated dataset that will be used for analysis&#39;) Table 3.1: Simulated dataset that will be used for analysis Predictor Description MathAch Mach Achievement; outcome variable, score on a (fictional) math test given to students S_ID Student ID; a single number representation of students, from 1 to 5200 SAT_M SAT math score; ranges from 200-800 and represents the SAT math score of students prior to entering JMU. S_gend Student gender; a non-binary gender indicator with 0 = female, 1 = male, and 2 = other/nonbinary/fluid female, NB Dummy coded student gender, since gender is categorical. Male is the reference S_SES Student SES; values range from 2-29 cite thing here num_tchrs Number of teachers; the number of math teachers a student had at JMU phys Physics; if a student took physics or not, with 0 = no and 1 = yes phys_tchr Physics teacher; if a student took physics, the ID of the teacher they had (ranging from 1  22) tchr1-tchr12 Teachers 1 through 12; teacher IDs (ranging from 1-56) of teachers students had. If a student had less than 12 teachers, teacher ID = 0 w1-w12 Weights; these represent the amount of time spent with each teacher. Values can range from 1 (only had one teacher) to 0.083 (had 12 teachers) t1_exp-t12_exp Teacher experience; Given the compact nature of this dataset, the experience of the first through twelfth teachers of each student is given in years. 3.1 Compact vs. long forms The data are in a .cvs file in compact form, as opposed to long form. Compact form contains two different sets of variables: one set for the first through twelfth teacher to instruct each student and another set represent the multiple membership weight variables. Wide form would have the same information, but in only one set of variables representing the individual teacher IDs and the proportion of time each teacher spent instructing each student (see tables below). While the wide form is less efficient, some programs require the data to be in one form or the other. In this instance, MLwiN using Bayesian routines (what we will be using) requires compact form (Leckie 2013b). 3.2 Examining the Data The next step is to determine what type of predictors we have and what they look like, as well as if we have a true hierarchical model, a nesting as nuisance model, or a non-hierarchical model such as cross-classified or multiple membership models. We will be looking for if students (in this case) belong to one and only one cluster (teachers), which would indicate a hierarchical approach or perhaps a nesting as nuisance approach. However, if, as is the case, students belong to multiple clusters, we will be taking a non-hierarchical approach. For this example, we are only considering one cluster, so we will be using a multiple membership design. We can see in the num_tchrs column there are students ranging from having had 1 teacher to 12 teachers, indicating we have a multiple membership column. We could also look at the tchr1 through tchr12 columns, and see there are values in more than one of those - indicating that students have encountered more than one math teacher. #Read in the data file StudData &lt;- read.csv(&quot;exampledata2.csv&quot;) #See what it looks like head(StudData) ## X.1 X S_ID S_gend S_SES num_tchrs phys tchr1 tchr2 tchr3 tchr4 tchr5 tchr6 tchr7 tchr8 tchr9 tchr10 tchr11 tchr12 w1 w2 w3 w4 w5 w6 ## 1 1 1 1 0 14.880674 3 0 24 32 46 0 0 0 0 0 0 0 0 0 0.33 0.33 0.33 0.00 0 0 ## 2 2 2 2 0 14.575710 4 0 30 52 54 18 0 0 0 0 0 0 0 0 0.25 0.25 0.25 0.25 0 0 ## 3 3 3 3 1 13.173884 1 0 12 0 0 0 0 0 0 0 0 0 0 0 1.00 0.00 0.00 0.00 0 0 ## 4 4 4 4 1 13.065602 2 0 32 30 0 0 0 0 0 0 0 0 0 0 0.50 0.50 0.00 0.00 0 0 ## 5 5 5 5 0 16.105715 2 0 3 48 0 0 0 0 0 0 0 0 0 0 0.50 0.50 0.00 0.00 0 0 ## 6 6 6 6 1 8.190244 2 1 3 44 0 0 0 0 0 0 0 0 0 0 0.50 0.50 0.00 0.00 0 0 ## w7 w8 w9 w10 w11 w12 Math t10_exp t1_exp t2_exp t3_exp t4_exp t5_exp t6_exp t7_exp t8_exp t9_exp t11_exp t12_exp phys_tchr SAT_M ## 1 0 0 0 0 0 0 524.4056 NA 7.504014 10.358077 8.625167 NA NA NA NA NA NA NA NA 0 795 ## 2 0 0 0 0 0 0 488.9099 NA 9.796930 11.785604 8.438843 8.458218 NA NA NA NA NA NA NA 0 693 ## 3 0 0 0 0 0 0 489.3046 NA 6.490974 NA NA NA NA NA NA NA NA NA NA 0 706 ## 4 0 0 0 0 0 0 477.3350 NA 10.358077 9.796930 NA NA NA NA NA NA NA NA NA 0 654 ## 5 0 0 0 0 0 0 429.6443 NA 12.899187 6.413480 NA NA NA NA NA NA NA NA NA 0 419 ## 6 0 0 0 0 0 0 428.4827 NA 12.899187 8.620738 NA NA NA NA NA NA NA NA NA 9 416 ## female NB ## 1 1 0 ## 2 1 0 ## 3 0 0 ## 4 0 0 ## 5 1 0 ## 6 0 0 summary(StudData) ## X.1 X S_ID S_gend S_SES num_tchrs phys tchr1 tchr2 ## Min. : 1 Min. : 1 Min. : 1 Min. :0.0000 Min. : 5.657 Min. : 1.000 Min. :0.0000 Min. : 1.00 Min. : 0.00 ## 1st Qu.:1301 1st Qu.:1301 1st Qu.:1301 1st Qu.:0.0000 1st Qu.:11.652 1st Qu.: 1.000 1st Qu.:0.0000 1st Qu.:14.00 1st Qu.: 0.00 ## Median :2600 Median :2600 Median :2600 Median :0.0000 Median :12.988 Median : 2.000 Median :0.0000 Median :29.00 Median :14.00 ## Mean :2600 Mean :2600 Mean :2600 Mean :0.4708 Mean :12.996 Mean : 2.593 Mean :0.2492 Mean :28.61 Mean :18.72 ## 3rd Qu.:3900 3rd Qu.:3900 3rd Qu.:3900 3rd Qu.:1.0000 3rd Qu.:14.353 3rd Qu.: 4.000 3rd Qu.:0.0000 3rd Qu.:43.00 3rd Qu.:35.00 ## Max. :5200 Max. :5200 Max. :5200 Max. :2.0000 Max. :20.249 Max. :12.000 Max. :1.0000 Max. :56.00 Max. :56.00 ## ## tchr3 tchr4 tchr5 tchr6 tchr7 tchr8 tchr9 tchr10 ## Min. : 0.000 Min. : 0.00 Min. : 0.00 Min. : 0.000 Min. : 0.0000 Min. : 0.0000 Min. : 0.0000 Min. : 0.0000 ## 1st Qu.: 0.000 1st Qu.: 0.00 1st Qu.: 0.00 1st Qu.: 0.000 1st Qu.: 0.0000 1st Qu.: 0.0000 1st Qu.: 0.0000 1st Qu.: 0.0000 ## Median : 0.000 Median : 0.00 Median : 0.00 Median : 0.000 Median : 0.0000 Median : 0.0000 Median : 0.0000 Median : 0.0000 ## Mean : 9.395 Mean : 7.23 Mean : 5.06 Mean : 2.623 Mean : 0.4515 Mean : 0.4065 Mean : 0.3956 Mean : 0.3735 ## 3rd Qu.:14.000 3rd Qu.: 1.00 3rd Qu.: 0.00 3rd Qu.: 0.000 3rd Qu.: 0.0000 3rd Qu.: 0.0000 3rd Qu.: 0.0000 3rd Qu.: 0.0000 ## Max. :56.000 Max. :56.00 Max. :56.00 Max. :56.000 Max. :55.0000 Max. :56.0000 Max. :56.0000 Max. :56.0000 ## ## tchr11 tchr12 w1 w2 w3 w4 w5 w6 ## Min. : 0.0000 Min. : 0.0000 Min. :0.0830 Min. :0.0000 Min. :0.00000 Min. :0.00000 Min. :0.00000 Min. :0.00000 ## 1st Qu.: 0.0000 1st Qu.: 0.0000 1st Qu.:0.2500 1st Qu.:0.0000 1st Qu.:0.00000 1st Qu.:0.00000 1st Qu.:0.00000 1st Qu.:0.00000 ## Median : 0.0000 Median : 0.0000 Median :0.5000 Median :0.2000 Median :0.00000 Median :0.00000 Median :0.00000 Median :0.00000 ## Mean : 0.3323 Mean : 0.2894 Mean :0.5784 Mean :0.2424 Mean :0.07666 Mean :0.04988 Mean :0.03008 Mean :0.01458 ## 3rd Qu.: 0.0000 3rd Qu.: 0.0000 3rd Qu.:1.0000 3rd Qu.:0.5000 3rd Qu.:0.16600 3rd Qu.:0.08300 3rd Qu.:0.00000 3rd Qu.:0.00000 ## Max. :56.0000 Max. :54.0000 Max. :1.0000 Max. :0.5000 Max. :0.33000 Max. :0.25000 Max. :0.20000 Max. :0.16600 ## ## w7 w8 w9 w10 w11 w12 Math t10_exp ## Min. :0.000000 Min. :0.00000 Min. :0.00000 Min. :0.000000 Min. :0.0000000 Min. :0.0000000 Min. :285.4 Min. : 6.874 ## 1st Qu.:0.000000 1st Qu.:0.00000 1st Qu.:0.00000 1st Qu.:0.000000 1st Qu.:0.0000000 1st Qu.:0.0000000 1st Qu.:387.9 1st Qu.: 8.947 ## Median :0.000000 Median :0.00000 Median :0.00000 Median :0.000000 Median :0.0000000 Median :0.0000000 Median :431.6 Median :10.329 ## Mean :0.001487 Mean :0.00124 Mean :0.00112 Mean :0.001035 Mean :0.0009777 Mean :0.0009258 Mean :431.7 Mean :10.288 ## 3rd Qu.:0.000000 3rd Qu.:0.00000 3rd Qu.:0.00000 3rd Qu.:0.000000 3rd Qu.:0.0000000 3rd Qu.:0.0000000 3rd Qu.:476.6 3rd Qu.:11.064 ## Max. :0.142800 Max. :0.12500 Max. :0.11000 Max. :0.100000 Max. :0.0900000 Max. :0.0830000 Max. :580.7 Max. :15.045 ## NA&#39;s :5136 ## t1_exp t2_exp t3_exp t4_exp t5_exp t6_exp t7_exp t8_exp ## Min. : 6.208 Min. : 6.208 Min. : 6.208 Min. : 6.208 Min. : 6.208 Min. : 6.208 Min. : 6.208 Min. : 6.208 ## 1st Qu.: 8.625 1st Qu.: 8.621 1st Qu.: 8.621 1st Qu.: 8.621 1st Qu.: 8.621 1st Qu.: 8.623 1st Qu.: 9.067 1st Qu.: 7.872 ## Median :10.292 Median :10.170 Median :10.025 Median :10.170 Median : 9.966 Median :10.292 Median :11.048 Median :10.025 ## Mean :10.137 Mean :10.077 Mean :10.034 Mean :10.082 Mean : 9.992 Mean :10.134 Mean :10.679 Mean : 9.839 ## 3rd Qu.:11.550 3rd Qu.:11.064 3rd Qu.:11.064 3rd Qu.:11.064 3rd Qu.:11.063 3rd Qu.:11.550 3rd Qu.:12.159 3rd Qu.:11.048 ## Max. :15.045 Max. :15.045 Max. :15.045 Max. :15.045 Max. :15.045 Max. :15.045 Max. :15.045 Max. :15.045 ## NA&#39;s :1748 NA&#39;s :3474 NA&#39;s :3894 NA&#39;s :4305 NA&#39;s :4709 NA&#39;s :5118 NA&#39;s :5127 ## t9_exp t11_exp t12_exp phys_tchr SAT_M female NB ## Min. : 6.208 Min. : 6.208 Min. : 6.413 Min. : 0.00 Min. :200.0 Min. :0.0000 Min. :0.0000 ## 1st Qu.: 8.625 1st Qu.: 9.108 1st Qu.: 8.625 1st Qu.: 0.00 1st Qu.:350.0 1st Qu.:0.0000 1st Qu.:0.0000 ## Median : 9.890 Median :10.329 Median :10.170 Median : 0.00 Median :500.0 Median :1.0000 Median :0.0000 ## Mean : 9.723 Mean :10.122 Mean :10.004 Mean : 2.88 Mean :499.8 Mean :0.5717 Mean :0.0425 ## 3rd Qu.:11.048 3rd Qu.:11.048 3rd Qu.:11.063 3rd Qu.: 0.00 3rd Qu.:646.2 3rd Qu.:1.0000 3rd Qu.:0.0000 ## Max. :14.599 Max. :14.599 Max. :14.139 Max. :22.00 Max. :800.0 Max. :1.0000 Max. :1.0000 ## NA&#39;s :5132 NA&#39;s :5140 NA&#39;s :5143 library(ggplot2) ggplot(data = StudData) + geom_histogram(aes(x = num_tchrs)) 3.3 Software Considerations MLwiN(cite) is one of the most commonly found software programs for running multiple membership models, as it can natively handle such complex models. I have found that SAS and Stata can be tricked into running simple multiple membership models by fitting them as constrained hierarchical models, but with non-continuous outcomes or increased complexity they quickly become computationally inefficient. More worryingly is that the parameter estimates generated by these methods are found to be biased. The same sources say that R can also be tricked, but I have not found that to be the case (Leckie 2013a). That said, both R and Stata have functions or packages that allow you to use their interface and run MLwiN in the background, both to allow use of a familiar interface but also to allow for accurate estimation methods with full model recognition. MLwiN is not a free software and is produced by the group XXX. A 30-day free trial with full functionality is available to anyone in the world, and for researchers in the US, a single-user license is £400 or a PhD license is available for XXX, though it expires after 3 years. In order to perform the analyses demonstrated below, I obtained a 30-day free license and used the R2MLwiN (Zhang et al. 2023) package to allow me to use an R interface. While the R code is provided, it will not work unless you also have a valid MLwiN license. Heck, Reid, and Leckie (2022) used OpenBUGS for some more complex multiple membership cross classified modeling of longitudinal data, but at this time OpenBUGS website no longer exists and has been ported to MultiBUGS Goudie et al. (2020). One potential drawback of this program is the mis-classification of its software framework by virus detection programs as a virus, leading it to be uninstallable or to throw errors. MultiBUGS also reports that an R interface (R2MultiBUGS) is under development. There are two steps to cross-reference any heading: Label the heading: # Hello world {#nice-label}. Leave the label off if you like the automated heading generated based on your heading title: for example, # Hello world = # Hello world {#hello-world}. To label an un-numbered heading, use: # Hello world {-#nice-label} or {# Hello world .unnumbered}. Next, reference the labeled heading anywhere in the text using \\@ref(nice-label); for example, please see Chapter ??. If you prefer text as the link instead of a numbered reference use: any text you want can go here. 3.4 Captioned figures and tables Figures and tables with captions can also be cross-referenced from elsewhere in your book using \\@ref(fig:chunk-label) and \\@ref(tab:chunk-label), respectively. See Figure 3.1. par(mar = c(4, 4, .1, .1)) plot(pressure, type = &#39;b&#39;, pch = 19) Figure 3.1: Here is a nice figure! Dont miss Table 3.2. knitr::kable( head(pressure, 10), caption = &#39;Here is a nice table!&#39;, booktabs = TRUE ) Table 3.2: Here is a nice table! temperature pressure 0 0.0002 20 0.0012 40 0.0060 60 0.0300 80 0.0900 100 0.2700 120 0.7500 140 1.8500 160 4.2000 180 8.8000 References "],["multiple-membership-models-the-details.html", "Chapter 4 Multiple Membership models: the details 4.1 Notation 4.2 Weights 4.3 Centering 4.4 VPC and ICC", " Chapter 4 Multiple Membership models: the details The key feature of a multiple membership model is that level 1 units do not belong to one and only one level 2 cluster. There may be some units that exhibit true hierarchy, but there are others that are multiple members: they belong to 2 or more clusters. A classic example of this is mobile students in educational settings (eg. Chung and Beretvas (2012), Heck, Reid, and Leckie (2022), Leroux, 2018). Another example in the health care setting is patient outcomes, but each patient frequently sees more than one nurse (Leckie 2013b). Using a multiple membership model allows the influence of multiple level 2 clusters to be taken into account. Additionally, just like ignoring hierarchical data violates the independent observations assumption and cause an inflated type I error rate, ignoring a multiple membership structure of your data will also cause an inflated type I error rate. Historically, when researchers encountered a multiple membership data structure (ie, mobile students) and were unable to model it correctly, there were a few options to handle this data that they would choose from, all of which resulted in mis-specified models. In one option, researchers would only consider the unit to be a member of their most recent cluster. As an example, only consider the school a child was in at the time of testing, rather than any other previous schools. Another option was to simply delete the mobile students from the data set, leaving only a pure hierarchy of students nested in schools. A third option was to acknowledge the mobility of students by including a dichotomous or ordinal mobility predictor to include in a regular hierarchical model. This would control for the influence of mobility on the outcome, but did not allow for the modeling of the effects of different schools on the student. However, none of these methods are an appropriate treatment of multiple membership data. The results obtained from the delete mobile students approach, for example, can only be generalized to other non-mobile students as well as decreasing the power. In the study by Chung and Beretvas (2012), they reported negative bias in the level 2 predictor coefficients and in the level 2 variance components when employing the only count the last school technique. In the same study, they also found that the level 1 variance components were positively biased. It is for these reasons that researchers investigating multiple membership data use a multiple membership model, in order to allow for generalization of results, proper capturing of mobile student effects, and validity of inferences about school effects (Smith and Beretvas 2017). 4.1 Notation There are three possibilities for how to depict these models, each with its own set of advantages and disadvantages. Standard hierarchical notation, which we are familiar with from truly hierarchical models, uses subscripts to identify individual and cluster level predictors and effects. The disadvantage of this notation is that, due to its familiarity, individuals may incorrectly assume that unit \\(\\textit{i}\\) is strictly nested within cluster \\(\\textit{j}\\), which is not the case (Raudenbush &amp; Bryk, 2002; Leckie (2013b)). Another method is to use multiple subscript notation (Beretvas, 2010). This notation makes the non-hierarchical structure more apparent, however, it can quickly become challenging to read. The notation we will use moving forward is classification notation (Leckie 2013b): \\[y_{i} = \\beta_{0} + \\sum_{j \\in school(i)}w_{j,i}^{(2)}u_{j}^{(2)} + e_{i}\\] \\[u_{j}^{(2)} \\sim N(0, \\sigma_{u(2)}^{2})\\] \\[e_{i} \\sim N(0, \\sigma_{e}^{2})\\] With this notation, the multiple membership component is represented by \\(\\sum_{j \\in school(i)}w_{j,i}^{(2)}u_{j}^{(2)}\\), which represents the weighted (\\(w_{j,i}^{(2)}\\)) cluster effects (\\(u_{j}^{(2)}\\)). The weight component represents the amount of time unit \\(\\textit{i}\\) spent in cluster \\(\\textit{j}\\), with the superscript (2) representing this is associated with the second level. All levels in the model are indicated, with level 1 (1) being implicit. The superscripts/subscripts for each level will identify to which level the random effects, variance parameters, and covariance parameters are associated with. If we look at the data, we can pull two students to see this model equation written out for each of them, student 1 and student 3. For student 1, we see that they had three teachers (24, 32, and 46) while student 3 only had one teacher (12). The equations for students 3 and 1 are shown below, indicating the role weights (discussed below) play in these models. 4.1.1 Student 3 \\[y_{3} = \\beta_{0} + \\sum_{j \\in \\{12\\}}w_{j,3}^{(2)}u_{j}^{(2)} + e_{3}\\] \\[ = \\beta_{0} + w_{12,3}^{(2)}u_{12}^{(2)} + e_{3}\\] \\[ = \\beta_{0} + u_{12}^{(2)} + e_{3}\\] ### Student 1 \\[y_{1} = \\beta_{0} + \\sum_{j \\in \\{24, 32, 46\\}}w_{j,1}^{(2)}u_{j}^{(2)} + e_{1}\\] \\[ = \\beta_{0} + w_{24,1}^{(2)}u_{24}^{(2)} + w_{32,1}^{(2)}u_{32}^{(2)} + w_{46,1}^{(2)}u_{46}^{(2)}+ e_{1}\\] \\[ = \\beta_{0} + 0.33u_{24}^{(2)} + 0.33u_{32}^{(2)} + 0.33u_{46}^{(2)}+ e_{1}\\] 4.2 Weights Weights are assigned to the level two clusters to reflect the different influences, and sum to one for any given level 1 unit. These are decided by the researcher, who may take one of several approaches. One approach is to assign equal weights, regardless of time. This is the approach taken in the example data set for this tutorial: it was assumed that each teacher seen by a student had equal influence, and the data set was designed in such a way that students did not see any given teacher more than once. In a mobile student situation, it may be that if a student attended a school for any length of time, that school would be given an equal weight to all the other schools attended by the student, even if they attended other schools for longer. Another approach is to account for length of time. In the previous example, if a student spent 1 year at school 1 but 2 years at school two, a researcher may weight school one as 0.33 and school 2 as 0.67. This will take into account the fact that since the student spent more time at school 2, it likely had a larger impact. A third approach seen is weighting later educational settings more heavily than earlier ones, to reflect the fact that the more recent education may have a larger impact on test scores (for example) than earlier education (Chung and Beretvas 2012). These weights are used both to identify amount of belonging to a particular level 2 cluster, but also to appropriately weight any level 2 predictors. For example, if we were to add in t_exp as teacher-level predictor, the resulting equations would look like this: \\[y_{i} = \\beta_{0} + \\beta_{1}\\sum_{j \\in school(i)}w_{j,i}^{(2)}t\\_exp_{2j}^{(2)} + \\sum_{j \\in school(i)}w_{j,i}^{(2)}u_{j}^{(2)} + e_{i}\\] \\[u_{j}^{(2)} \\sim N(0, \\sigma_{u(2)}^{2})\\] \\[e_{i} \\sim N(0, \\sigma_{e}^{2})\\] The term \\(\\sum_{j \\in school(i)}w_{j,i}^{(2)}t\\_exp_{2j}^{(2)}\\) is teacher experience (t_exp), taking into account that since students saw different teachers, the experience of those teachers will be different. This is called the weighted sum of this predictor, with _{1} being the slope coefficient. We are able to keep the term as-is in our equation, or to simplify the equation, we could calculate it in our data set to be \\(\\bar x_{2i}\\). The resulting equation would then be \\[y_{i} = \\beta_{0} + \\beta_{1}\\overline{(t\\_exp)}_{2i} + \\sum_{j \\in school(i)}w_{j,i}^{(2)}u_{j}^{(2)} + e_{i}\\] 4.3 Centering In pure hierarchical models, predictors (typically at level 1) can either be group mean centered (CWC) or grand mean centered (CGM), with CWC being the generally preferred option due to the resulting interpretability of the coefficients (Enders 2013). However, in a multiple membership model, level 1 units belong to one or more level 2 clusters, meaning group mean centering can get really complicated really fast and indeed may not be possible. If centering is mentioned in the literature surrounding multiple membership models, it is only grand mean centering that is referenced. This may be due to ease, or due to lack of exploration using group mean centering. Much of the literature using multiple membership models (eg. XXXXX) did not mention any type of centering; an example where it was mentioned is Smith and Beretvas (2017), where it is specifically addressed in their model descriptions. 4.4 VPC and ICC References "],["running-a-multiple-membership-model.html", "Chapter 5 Running a Multiple Membership Model 5.1 Intercept-only Model 5.2 The Output 5.3 Adding in level 1 predictors 5.4 Adding in level 2 predictors 5.5 Footnotes 5.6 Citations", " Chapter 5 Running a Multiple Membership Model As noted in 3.3, the only software currently able to run a multiple membership model is MLwiN (add ref). There is an R package, R2MLwiN (Zhang et al. 2023) that allows for an R-interface which runs MLwiN in the background. This allows users to work with a program they are already familiar with while accessing the capabilities of MLwiN. However, as also previously noted, you must have an active MLwiN license, and have the program installed on your computer for your R code to work. 5.1 Intercept-only Model We will first run an intercept-only model, looking at Math as an outcome and only including the intercept and the multiple membership effect of teachers. This model will inform us as to how the variance in Math scores is divided between teacher variance components (level 2) and student variance components (level 1). 5.1.1 First Steps Setting this up to run in R, we first need to make sure we have MLwiN installed, as well as call the R2MLwiN package. Additionally, R2MLwiN defaults the path to MLwiN as C:/Program Files/MLwiN v3.06/. If yours, like mine, is installed elsewhere, you need to include options(MLwiN_pah = \"path/to/MLwiN\"). An easy way to copy the path is to find it in your computer, hold shift and right click the program. The option copy as path comes up as an option, and you can just paste it in. 5.1.2 Define the model After we have loaded in the appropriate packages, we take a few steps to actually run the model. First, we define the intercept-only model, including both the teacher columns and the student IDs. For our dataset, our model definition will be intonly &lt;- Math ~ 1 + (1|tchr1) + (1|S_ID). Important to note is that when defining the teacher columns ((1|tchr1)), we use the first column name, not tchr as you might be inclined to do. The random part of the model, (1|tchr1) and (1|S_ID), is written in descending order of hierarchy. With this model specification, we are allowing intercepts to vary at level 2 ((1|tchr1)) and level 1 ((1|S_ID)). 5.1.3 Set up and send to MLwiN The next step is to define the multiple membership variables (teacher columns for us) and the associated weights. To do this, we make an object that is a list of list of lists. I named it MultiMemb in the code chunk below: MultiMemb &lt;- list(list( mmvar = list(&quot;tchr1&quot;, &quot;tchr2&quot;, &quot;tchr3&quot;, &quot;tchr4&quot;, &quot;tchr5&quot;, &quot;tchr6&quot;, &quot;tchr7&quot;, &quot;tchr8&quot;, &quot;tchr9&quot;, &quot;tchr10&quot;, &quot;tchr11&quot;, &quot;tchr12&quot;), weights = list(&quot;w1&quot;, &quot;w2&quot;, &quot;w3&quot;, &quot;w4&quot;, &quot;w5&quot;, &quot;w6&quot;, &quot;w7&quot;, &quot;w8&quot;, &quot;w9&quot;, &quot;w10&quot;, &quot;w11&quot;, &quot;w12&quot;)), NA) Within this, mmvar specifies classification units (unit of multiple membership). weights is where the associated weights go, and is the student-level weighting (in our case) given to each teacher they had. The final NA indicates that level 1 has no multiple membership classification. This set-up is why our data needed to be in compact rather than long form (3.1). After we have defined MultiMemb, we can actually run the model. This line is putting everything together: (MMembModel1 &lt;- runMLwiN(Formula = intonly, data = StudData, estoptions = list(EstM = 1, drop.data = FALSE, mm = MultiMemb))) Looking at it, we are calling MLwiN with runMLwiN, defining what the model should be with Formula, and defining our data set with data. estoptions is our estimation options. When EstM is equal to 1, we are using MCMC estimation. And lastly, within that same statement, mm is calling our MultiMemb object to match everything up and weight appropriately. 5.1.4 Put it all together Taking everything from above and putting it all together, we get the following code chunk, and then output. library(R2MLwiN) ## Warning: package &#39;R2MLwiN&#39; was built under R version 4.1.3 options(MLwiN_path=&quot;C:\\\\Program Files (x86)\\\\MLwiN trial\\\\i386\\\\mlwin.exe&quot;) intonly &lt;- Math ~ 1 + (1|tchr1) + (1|S_ID) MultiMemb &lt;- list(list( mmvar = list(&quot;tchr1&quot;, &quot;tchr2&quot;, &quot;tchr3&quot;, &quot;tchr4&quot;, &quot;tchr5&quot;, &quot;tchr6&quot;, &quot;tchr7&quot;, &quot;tchr8&quot;, &quot;tchr9&quot;, &quot;tchr10&quot;, &quot;tchr11&quot;, &quot;tchr12&quot;), weights = list(&quot;w1&quot;, &quot;w2&quot;, &quot;w3&quot;, &quot;w4&quot;, &quot;w5&quot;, &quot;w6&quot;, &quot;w7&quot;, &quot;w8&quot;, &quot;w9&quot;, &quot;w10&quot;, &quot;w11&quot;, &quot;w12&quot;)), NA) (MMembModel1 &lt;- runMLwiN(Formula = intonly, data = StudData, estoptions = list(EstM = 1, drop.data = FALSE, mm = MultiMemb))) ## MLwiN is running, please wait...... ## ## -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*- ## MLwiN (version: 2.36) multilevel model (Normal) ## N min mean max N_complete min_complete mean_complete max_complete ## tchr1 56 75 92.85714 122 56 75 92.85714 122 ## Estimation algorithm: MCMC Cross-classified Elapsed time : 7.74s ## Number of obs: 5200 (from total 5200) Number of iter.: 5000 Chains: 1 Burn-in: 500 ## Bayesian Deviance Information Criterion (DIC) ## Dbar D(thetabar) pD DIC ## 56499.020 56452.727 46.295 56545.316 ## --------------------------------------------------------------------------------------------------- ## The model formula: ## Math ~ 1 + (1 | tchr1) + (1 | S_ID) ## Level 2: tchr1 Level 1: S_ID ## --------------------------------------------------------------------------------------------------- ## The fixed part estimates: ## Coef. Std. Err. z Pr(&gt;|z|) [95% Cred. Interval] ESS ## Intercept 431.40460 2.19878 196.20 0 *** 427.12021 435.63257 400 ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## --------------------------------------------------------------------------------------------------- ## The random part estimates at the tchr1 level: ## Coef. Std. Err. [95% Cred. Interval] ESS ## var_Intercept 242.27295 59.40378 148.16777 380.94221 2247 ## --------------------------------------------------------------------------------------------------- ## The random part estimates at the S_ID level: ## Coef. Std. Err. [95% Cred. Interval] ESS ## var_Intercept 3064.03716 60.17766 2947.00892 3182.79320 5000 ## -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*- 5.2 The Output Looking at the output from our intercept only model, we have a lot of information. First, R and MLwiN are reminding us what we put in: MLwiN (version: 2.36) multilevel model (Normal) N min mean max N_complete min_complete mean_complete max_complete tchr1 56 75 92.85714 122 56 75 92.85714 122 Estimation algorithm: MCMC Cross-classified Elapsed time : 9.42s Number of obs: 5200 (from total 5200) Number of iter.: 5000 Chains: 1 Burn-in: 500 We then get the DIC: Bayesian Deviance Information Criterion (DIC) Dbar D(thetabar) pD DIC 56499.285 56453.141 46.146 56545.430 This is our baseline, to which other models including predictors will be compared to. If a predictor is useful at explaining variance, we expect the DIC to decrease. We can also use the DIC to determine if the multiple membership model is preferred to a single level model. The single model would be specified and run as follows: intonlyred &lt;- Math ~ 1 + (1|S_ID) (MMembModelRed &lt;- runMLwiN(Formula = intonlyred, data = StudData, estoptions = list(EstM = 1))) ## MLwiN is running, please wait...... ## ## -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*- ## MLwiN (version: 2.36) multilevel model (Normal) ## Estimation algorithm: MCMC Elapsed time : 4.02s ## Number of obs: 5200 (from total 5200) Number of iter.: 5000 Chains: 1 Burn-in: 500 ## Bayesian Deviance Information Criterion (DIC) ## Dbar D(thetabar) pD DIC ## 56719.672 56717.707 1.968 56721.641 ## --------------------------------------------------------------------------------------------------- ## The model formula: ## Math ~ 1 + (1 | S_ID) ## Level 1: S_ID ## --------------------------------------------------------------------------------------------------- ## The fixed part estimates: ## Coef. Std. Err. z Pr(&gt;|z|) [95% Cred. Interval] ESS ## Intercept 431.66063 0.77682 555.67 0 *** 430.13493 433.16530 5000 ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## --------------------------------------------------------------------------------------------------- ## The random part estimates at the S_ID level: ## Coef. Std. Err. [95% Cred. Interval] ESS ## var_Intercept 3198.48491 62.42396 3080.30035 3325.47068 5000 ## -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*- From the output, we see that the DIC for the single level model is 56721.641, which is 176.211 higher than the multiple membership model. This indicates that the multiple membership model is statistically preferred over the single level model. We next get reminded of our model formula, and what the grouping predictors were: The model formula: Math ~ 1 + (1 | tchr1) + (1 | S_ID) Level 2: tchr1 Level 1: S_ID Skipping down to The fixed part estimates: The fixed part estimates: Coef. Std. Err. z Pr(&gt;|z|) [95% Cred. Interval] ESS Intercept 431.52398 2.21944 194.43 0 *** 426.97449 435.91524 395 Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 we see that the intercept is 431.52. This is the overall mean of math achievement across all the students and all the teachers. Conveniently, this output also provides us with a 95% credibility interval of (426.97, 435.91) indicating STUFF******. Going further down, we come to the random part estimates at level 2 and level 1, or the variance components: The random part estimates at the tchr1 level: Coef. Std. Err. [95% Cred. Interval] ESS var_Intercept 238.96526 57.92255 147.42228 374.11760 2080 --------------------------------------------------------------------------------------------------- The random part estimates at the S_ID level: Coef. Std. Err. [95% Cred. Interval] ESS var_Intercept 3064.65607 59.68536 2948.33898 3181.76541 4681 Using these, we can calculate the variance partition coefficient (VPC) for this model, which will tell us the proportion of variance in Math scores that is at each level of our model. However, as previously mentioned in 4.4, using only the values in the table will only tell us the variance partition coefficient for students who only had a single teacher. 5.3 Adding in level 1 predictors lev1 &lt;- Math ~ 1 + S_SES + female + NB + SAT_M + (1|tchr1) + (1|S_ID) MultiMemb &lt;- list(list( mmvar = list(&quot;tchr1&quot;, &quot;tchr2&quot;, &quot;tchr3&quot;, &quot;tchr4&quot;, &quot;tchr5&quot;, &quot;tchr6&quot;, &quot;tchr7&quot;, &quot;tchr8&quot;, &quot;tchr9&quot;, &quot;tchr10&quot;, &quot;tchr11&quot;, &quot;tchr12&quot;), weights = list(&quot;w1&quot;, &quot;w2&quot;, &quot;w3&quot;, &quot;w4&quot;, &quot;w5&quot;, &quot;w6&quot;, &quot;w7&quot;, &quot;w8&quot;, &quot;w9&quot;, &quot;w10&quot;, &quot;w11&quot;, &quot;w12&quot;)), NA) (MMembModel2 &lt;- runMLwiN(Formula = lev1, data = StudData, estoptions = list(EstM = 1, drop.data = FALSE, mm = MultiMemb))) 5.4 Adding in level 2 predictors 5.5 Footnotes Footnotes are put inside the square brackets after a caret ^[]. Like this one 1. 5.6 Citations Reference items in your bibliography file(s) using @key. For example, we are using the bookdown package (Xie 2023) (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and knitr (Xie 2015) (this citation was added manually in an external file book.bib). Note that the .bib files need to be listed in the index.Rmd with the YAML bibliography key. The RStudio Visual Markdown Editor can also make it easier to insert citations: https://rstudio.github.io/visual-markdown-editing/#/citations References "],["other-uses-of-multiple-membership-models.html", "Chapter 6 Other uses of Multiple Membership Models 6.1 Equations 6.2 Theorems and proofs 6.3 Callout blocks", " Chapter 6 Other uses of Multiple Membership Models 6.1 Equations Here is an equation. \\[\\begin{equation} f\\left(k\\right) = \\binom{n}{k} p^k\\left(1-p\\right)^{n-k} \\tag{6.1} \\end{equation}\\] You may refer to using \\@ref(eq:binom), like see Equation (6.1). 6.2 Theorems and proofs Labeled theorems can be referenced in text using \\@ref(thm:tri), for example, check out this smart theorem 6.1. Theorem 6.1 For a right triangle, if \\(c\\) denotes the length of the hypotenuse and \\(a\\) and \\(b\\) denote the lengths of the other two sides, we have \\[a^2 + b^2 = c^2\\] Read more here https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html. 6.3 Callout blocks The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html "],["increasing-complexity.html", "Chapter 7 Increasing complexity 7.1 Publishing 7.2 404 pages 7.3 Metadata for sharing", " Chapter 7 Increasing complexity 7.1 Publishing HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html 7.2 404 pages By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If youd like to customize your 404 page instead of using the default, you may add either a _404.Rmd or _404.md file to your project root and use code and/or Markdown syntax. 7.3 Metadata for sharing Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the index.Rmd YAML. To setup, set the url for your book and the path to your cover-image file. Your books title and description are also used. This gitbook uses the same social sharing data across all chapters in your book- all links shared will look the same. Specify your books source repository on GitHub using the edit key under the configuration options in the _output.yml file, which allows users to suggest an edit by linking to a chapters source file. Read more about the features of this output format here: https://pkgs.rstudio.com/bookdown/reference/gitbook.html Or use: ?bookdown::gitbook "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
